

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyrexMD.analysis.contacts &mdash; pyrexMD 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >
          

          
            <a href="../../../index.html" class="icon icon-home"> pyrexMD
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about_pyrexMD.html">About pyrexMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quick_guide.html">Quick Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">API Docs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyrexMD</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../pyrexMD.html">pyrexMD</a> &raquo;</li>
        
      <li>pyrexMD.analysis.contacts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyrexMD.analysis.contacts</h1><div class="highlight"><pre>
<span></span><span class="c1"># @Author: Arthur Voronin</span>
<span class="c1"># @Date:   07.05.2021</span>
<span class="c1"># @Filename: contacts.py</span>
<span class="c1"># @Last modified by:   arthur</span>
<span class="c1"># @Last modified time: 30.06.2021</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains functions related to native contact and bias contact analyses.</span>


<span class="sd">Example:</span>
<span class="sd">--------</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    import MDAnalysis as mda</span>
<span class="sd">    import pyrexMD.analysis.contacts as con</span>

<span class="sd">    ref = mda.Universe(&quot;path/to/pdb&quot;)</span>
<span class="sd">    mobile = mda.Universe(&quot;path/to/tpr&quot;, &quot;path/to/xtc&quot;)</span>

<span class="sd">    # get and plot native contacts</span>
<span class="sd">    con.get_Native_Contacts(ref, sel=&quot;protein&quot;)</span>
<span class="sd">    con.plot_Contact_Map(ref, sel=&quot;protein&quot;)</span>

<span class="sd">    # compare contact map for n bias contacts</span>
<span class="sd">    n = 50</span>
<span class="sd">    con.plot_Contact_Map(ref, DCA_fin=&quot;path/to/bias/contacts&quot;, n_DCA=n)</span>

<span class="sd">    # check true positive rate for n bias contacts</span>
<span class="sd">    n = 50</span>
<span class="sd">    con.plot_DCA_TPR(ref, DCA_fin=&quot;path/to/bias/contacts&quot;, n_DCA=n)</span>

<span class="sd">Module contents:</span>
<span class="sd">----------------</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pyrexMD.analysis.analysis</span> <span class="k">as</span> <span class="nn">_ana</span>
<span class="kn">import</span> <span class="nn">pyrexMD.misc</span> <span class="k">as</span> <span class="nn">_misc</span>
<span class="kn">import</span> <span class="nn">pyrexMD.topology</span> <span class="k">as</span> <span class="nn">_top</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">MDAnalysis</span> <span class="k">as</span> <span class="nn">mda</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.analysis</span> <span class="kn">import</span> <span class="n">contacts</span> <span class="k">as</span> <span class="n">_contacts</span><span class="p">,</span> <span class="n">distances</span> <span class="k">as</span> <span class="n">_distances</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>


<div class="viewcode-block" id="get_Native_Contacts"><a class="viewcode-back" href="../../../pyrexMD.analysis.html#pyrexMD.analysis.contacts.get_Native_Contacts">[docs]</a><span class="k">def</span> <span class="nf">get_Native_Contacts</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">d_cutoff</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="s2">&quot;protein&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get list of unique RES pairs and list of detailed RES pairs with native contacts.</span>

<span class="sd">    .. Note ::  len(NC) &lt; len(NC_d) because NC contains only unique RES pairs</span>
<span class="sd">        whereas NC_d contains each ATOM pair.</span>

<span class="sd">    Args:</span>
<span class="sd">        ref (str, universe, atomgrp): reference structure</span>
<span class="sd">        d_cutoff (float): cutoff distance for native contacts</span>
<span class="sd">        sel (str): selection string</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        method (str):</span>
<span class="sd">          | &#39;1&#39; or &#39;Contact_Matrix&#39;: mda.contact_matrix() with d_cutoff</span>
<span class="sd">          | &#39;2&#39; or &#39;Shadow_Map&#39; #TODO</span>
<span class="sd">        norm (bool): apply topology.norm_universe()</span>
<span class="sd">        ignh (bool): ignore hydrogen</span>
<span class="sd">        save_as (None, str):</span>
<span class="sd">          | save RES pairs and ATOM pairs of native contacts to a log file.</span>
<span class="sd">          | selection is hardcoded to &quot;protein and name CA&quot; for proteins</span>
<span class="sd">          | and &quot;name N1 or name N3&quot; for RNA/DNA.</span>

<span class="sd">    Returns:</span>
<span class="sd">        NC (list)</span>
<span class="sd">            native contacts with unique RES pairs</span>
<span class="sd">        NC_d (list)</span>
<span class="sd">            detailed list of NCs containing (RES pairs), (ATOM numbers), (ATOM names)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
               <span class="s2">&quot;norm&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;ignh&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;save_as&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1">############################################################################</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">method</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>

    <span class="c1"># load universe</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">ref</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">:</span>
        <span class="n">_top</span><span class="o">.</span><span class="n">norm_universe</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">ignh</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">_top</span><span class="o">.</span><span class="n">true_select_atoms</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">ignh</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ignh</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>

    <span class="n">NC</span> <span class="o">=</span> <span class="p">[]</span>     <span class="c1"># list with unique NC pairs</span>
    <span class="n">NC_d</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># detailed list with NCs containing (RES pairs), (ATOM pairs), (NAME pairs)</span>

    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Contact_Matrix&#39;</span><span class="p">,</span> <span class="s1">&#39;contact_matrix&#39;</span><span class="p">]:</span>
        <span class="n">RES</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">resids</span>
        <span class="n">IDS</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ids</span>
        <span class="n">NAMES</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">names</span>

        <span class="n">CM</span> <span class="o">=</span> <span class="n">_distances</span><span class="o">.</span><span class="n">contact_matrix</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="n">d_cutoff</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">CM</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">CM</span><span class="p">)):</span>  <span class="c1"># no double count/reduce computing time</span>
                <span class="k">if</span> <span class="n">RES</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">CM</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="p">(</span><span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">RES</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NC</span><span class="p">:</span>
                    <span class="n">NC</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">RES</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                    <span class="n">NC_d</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">RES</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="p">(</span><span class="n">IDS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">IDS</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="p">(</span><span class="n">NAMES</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">NAMES</span><span class="p">[</span><span class="n">j</span><span class="p">])])</span>

    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;Shadow_Map&#39;</span><span class="p">,</span> <span class="s1">&#39;shadow_map&#39;</span><span class="p">]:</span>
        <span class="c1"># TODO method 2: SHADOWMAP</span>
        <span class="k">pass</span>

    <span class="c1"># sort</span>
    <span class="n">NC</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">NC</span><span class="p">)</span>
    <span class="n">NC_d</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">NC_d</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">save_as</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">save_as</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">save_as</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="s2">&quot;nucleic&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># hardcoded protein selection</span>
            <span class="n">resid</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">_top</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="s2">&quot;protein and name CA&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># hardcoded nucleic selection</span>
            <span class="n">resid</span><span class="p">,</span> <span class="n">resname</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">_top</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="s2">&quot;name N1 or name N3&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">save_as</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#RESi</span><span class="se">\t</span><span class="s2">RESj</span><span class="se">\t</span><span class="s2">ATOMi</span><span class="se">\t</span><span class="s2">ATOMj</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">IJ</span> <span class="ow">in</span> <span class="n">NC</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">IJ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">IJ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">id</span><span class="p">[</span><span class="n">resid</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">IJ</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="nb">id</span><span class="p">[</span><span class="n">resid</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">IJ</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved file as: </span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">save_as</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">NC</span><span class="p">,</span> <span class="n">NC_d</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_NC_distances"><a class="viewcode-back" href="../../../pyrexMD.analysis.html#pyrexMD.analysis.contacts.get_NC_distances">[docs]</a><span class="k">def</span> <span class="nf">get_NC_distances</span><span class="p">(</span><span class="n">mobile</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">sss</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">sel</span><span class="o">=</span><span class="s2">&quot;protein&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;shortest_distance&quot;</span><span class="p">,</span> <span class="n">d_cutoff</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get native contact distances.</span>

<span class="sd">    Args:</span>
<span class="sd">        mobile (universe, str)</span>
<span class="sd">        ref (universe, str)</span>
<span class="sd">        sss (list):</span>
<span class="sd">          | [start, stop, step]</span>
<span class="sd">          | start (None, int): start frame</span>
<span class="sd">          | stop (None, int): stop frame</span>
<span class="sd">          | step (None, int): step size</span>
<span class="sd">        sel (str): selection string</span>
<span class="sd">        method (str):</span>
<span class="sd">          | &#39;shortest_distance&#39;: uses shortest RES distance between selection atoms</span>
<span class="sd">          | &#39;contact_distance&#39;:</span>
<span class="sd">          |     protein target ~ use distances of CA atoms</span>
<span class="sd">          |     RNA target ~ use distances of N1 and N3 atoms based on nucleic residues according to topology.sel2selid()</span>
<span class="sd">        d_cutoff (float): cutoff distance</span>
<span class="sd">        plot (bool)</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        start (None, int): start frame</span>
<span class="sd">        stop (None, int): stop frame</span>
<span class="sd">        step (None, int): step size</span>
<span class="sd">        norm (bool): apply topology.norm_universe()</span>
<span class="sd">        ignh (bool): ignore hydrogen (mass &lt; 1.2)</span>
<span class="sd">        save_as (None, str): save native contacts logfile as...</span>

<span class="sd">    Returns:</span>
<span class="sd">        NC (list)</span>
<span class="sd">            native contacts with unique RES pairs</span>
<span class="sd">        NC_dist (list)</span>
<span class="sd">            native contact distances ~ distances of items in NC</span>
<span class="sd">        DM (array)</span>
<span class="sd">            array of distance matrices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
               <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
               <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
               <span class="s2">&quot;norm&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;ignh&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;save_as&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;save_as&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;save_as&quot;</span><span class="p">]</span>
    <span class="c1">##########################################################</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mobile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">mobile</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">mobile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">:</span>
        <span class="n">_top</span><span class="o">.</span><span class="n">norm_universe</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
        <span class="n">_top</span><span class="o">.</span><span class="n">norm_universe</span><span class="p">(</span><span class="n">mobile</span><span class="p">)</span>

    <span class="c1"># convert sel to selids</span>
    <span class="n">selid1</span> <span class="o">=</span> <span class="n">_top</span><span class="o">.</span><span class="n">sel2selid</span><span class="p">(</span><span class="n">mobile</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">selid2</span> <span class="o">=</span> <span class="n">_top</span><span class="o">.</span><span class="n">sel2selid</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>

    <span class="c1"># get native contacts and distance matrices</span>
    <span class="n">NC</span><span class="p">,</span> <span class="n">NC_d</span> <span class="o">=</span> <span class="n">get_Native_Contacts</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">selid2</span><span class="p">,</span> <span class="n">d_cutoff</span><span class="o">=</span><span class="n">d_cutoff</span><span class="p">,</span>
                                   <span class="n">ignh</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ignh</span><span class="p">,</span> <span class="n">save_as</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">save_as</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;shortest_distance&quot;</span><span class="p">:</span>
        <span class="n">DM</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">mobile</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="n">cfg</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">cfg</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span><span class="n">cfg</span><span class="o">.</span><span class="n">step</span><span class="p">]:</span>
            <span class="n">SD</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_ana</span><span class="o">.</span><span class="n">get_shortest_RES_distances</span><span class="p">(</span><span class="n">mobile</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">selid1</span><span class="p">)</span>
            <span class="n">DM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SD</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;contact_distance&quot;</span><span class="p">:</span>
        <span class="n">DM</span> <span class="o">=</span> <span class="n">_ana</span><span class="o">.</span><span class="n">get_Distance_Matrices</span><span class="p">(</span><span class="n">mobile</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">selid1</span><span class="p">,</span> <span class="n">sss</span><span class="o">=</span><span class="p">[</span><span class="n">cfg</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">step</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;method must be either &#39;shortest_distance&#39; or &#39;contact_distance&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># get native contact distances</span>
    <span class="n">NC_dist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dm</span> <span class="ow">in</span> <span class="n">DM</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">NC</span><span class="p">:</span>
            <span class="n">NC_dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dm</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">_ana</span><span class="o">.</span><span class="n">plot_hist</span><span class="p">(</span><span class="n">NC_dist</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Residue Pair Distance ($\AA$)&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">NC</span><span class="p">,</span> <span class="n">NC_dist</span><span class="p">,</span> <span class="n">DM</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_BC_distances"><a class="viewcode-back" href="../../../pyrexMD.analysis.html#pyrexMD.analysis.contacts.get_BC_distances">[docs]</a><span class="k">def</span> <span class="nf">get_BC_distances</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">sss</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">sel</span><span class="o">=</span><span class="s2">&quot;protein&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;shortest_distance&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get bias contact distances.</span>

<span class="sd">    Args:</span>
<span class="sd">        u (universe, str)</span>
<span class="sd">        bc (list): list of bias contacts represented by (RESi, RESj) tuple</span>
<span class="sd">        sss (list):</span>
<span class="sd">          | [start, stop, step]</span>
<span class="sd">          | start (None, int): start frame</span>
<span class="sd">          | stop (None, int): stop frame</span>
<span class="sd">          | step (None, int): step size</span>
<span class="sd">        sel (str): selection string</span>
<span class="sd">        method (str):</span>
<span class="sd">          | &#39;shortest_distance&#39;: uses shortest RES distance between selection atoms</span>
<span class="sd">          | &#39;contact_distance&#39;:</span>
<span class="sd">          |     protein target ~ use distances of CA atoms</span>
<span class="sd">          |     RNA target ~ use distances of N1 and N3 atoms based on nucleic residues according to topology.sel2selid()</span>
<span class="sd">        plot (bool)</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        start (None, int): start frame</span>
<span class="sd">        stop (None, int): stop frame</span>
<span class="sd">        step (None, int): step size</span>
<span class="sd">        norm (bool): apply topology.norm_universe()</span>
<span class="sd">        ignh (bool): ignore hydrogen (mass &lt; 1.2)</span>
<span class="sd">        save_as (None, str): save native contacts logfile as...</span>

<span class="sd">    Returns:</span>
<span class="sd">        BC (list)</span>
<span class="sd">            bias contacts with unique RES pairs</span>
<span class="sd">        BC_dist (list)</span>
<span class="sd">            bias contact distances ~ distances of items in BC</span>
<span class="sd">        DM (array)</span>
<span class="sd">            array of distance matrices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">BC</span> <span class="o">=</span> <span class="n">bc</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
               <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
               <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
               <span class="s2">&quot;norm&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;ignh&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;save_as&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;save_as&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;save_as&quot;</span><span class="p">]</span>
    <span class="c1">##########################################################</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">:</span>
        <span class="n">_top</span><span class="o">.</span><span class="n">norm_universe</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

    <span class="c1"># convert sel to selid</span>
    <span class="n">selid</span> <span class="o">=</span> <span class="n">_top</span><span class="o">.</span><span class="n">sel2selid</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>

    <span class="c1"># get native contacts and distance matrices</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;shortest_distance&quot;</span><span class="p">:</span>
        <span class="n">DM</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="n">cfg</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">cfg</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span><span class="n">cfg</span><span class="o">.</span><span class="n">step</span><span class="p">]:</span>
            <span class="n">SD</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_ana</span><span class="o">.</span><span class="n">get_shortest_RES_distances</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">selid</span><span class="p">)</span>
            <span class="n">DM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SD</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;contact_distance&quot;</span><span class="p">:</span>
        <span class="n">DM</span> <span class="o">=</span> <span class="n">_ana</span><span class="o">.</span><span class="n">get_Distance_Matrices</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">selid</span><span class="p">,</span> <span class="n">sss</span><span class="o">=</span><span class="p">[</span><span class="n">cfg</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">step</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;method must be either &#39;shortest_distance&#39; or &#39;contact_distance&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># get native contact distances</span>
    <span class="n">BC_dist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dm</span> <span class="ow">in</span> <span class="n">DM</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">BC</span><span class="p">:</span>
            <span class="n">BC_dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dm</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">_ana</span><span class="o">.</span><span class="n">plot_hist</span><span class="p">(</span><span class="n">BC_dist</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Residue Pair Distance ($\AA$)&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">BC</span><span class="p">,</span> <span class="n">BC_dist</span><span class="p">,</span> <span class="n">DM</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_Contact_Map"><a class="viewcode-back" href="../../../pyrexMD.analysis.html#pyrexMD.analysis.contacts.plot_Contact_Map">[docs]</a><span class="k">def</span> <span class="nf">plot_Contact_Map</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">DCA_fin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_DCA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d_cutoff</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span>
                     <span class="n">sel</span><span class="o">=</span><span class="s1">&#39;protein&#39;</span><span class="p">,</span> <span class="n">pdbid</span><span class="o">=</span><span class="s1">&#39;pdbid&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create contact map based on the reference pdb structure.</span>
<span class="sd">    If DCA file is passed, correct/wrong contacts are visualized in green/red.</span>

<span class="sd">    Args:</span>
<span class="sd">        ref (str, universe, atomgrp): reference path or structure</span>
<span class="sd">        DCA_fin (None, str): DCA input file</span>
<span class="sd">        n_DCA (None, int): number of used DCA contacts</span>
<span class="sd">        d_cutoff (float): cutoff distance for native contacts</span>
<span class="sd">        sel (str): selection string</span>
<span class="sd">        pdbid (str): pdbid which is used for plot title</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        DCA_cols (tuple): columns containing the RES pairs in DCA_fin</span>
<span class="sd">        DCA_skiprows (int):</span>
<span class="sd">          | skip header rows of DCA_fin</span>
<span class="sd">          | -1 or &quot;auto&quot;: auto detect</span>
<span class="sd">        filter_DCA (bool):</span>
<span class="sd">          | True: ignore DCA pairs with abs(i-j) &lt; 3.</span>
<span class="sd">          | False: use all DCA pairs w/o applying filter.</span>
<span class="sd">        RES_range (None, list):</span>
<span class="sd">          | include RES only within [RES_min, RES_max] range</span>
<span class="sd">          | None: do not narrow down RES range</span>
<span class="sd">        ignh (bool): ignore hydrogen (mass &lt; 1.2)</span>
<span class="sd">        norm (bool): apply topology.norm_universe()</span>
<span class="sd">        save_plot (bool)</span>
<span class="sd">        ms (None, int): marker size (should be divisible by 2)</span>

<span class="sd">    .. hint:: Args and Keyword Args of misc.figure() are also valid.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig (class)</span>
<span class="sd">            matplotlib.figure.Figure</span>
<span class="sd">        ax (class, list)</span>
<span class="sd">            ax or list of axes ~ matplotlib.axes._subplots.Axes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;DCA_cols&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="s2">&quot;DCA_skiprows&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
               <span class="s2">&quot;filter_DCA&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;RES_range&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
               <span class="s2">&quot;ignh&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;norm&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># init values</span>
    <span class="k">if</span> <span class="s2">&quot;figsize&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

    <span class="c1"># load universe</span>
    <span class="k">if</span> <span class="n">pdbid</span> <span class="o">==</span> <span class="s1">&#39;pdbid&#39;</span><span class="p">:</span>
        <span class="n">pdbid</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">get_PDBid</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">ref</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">:</span>
        <span class="n">_top</span><span class="o">.</span><span class="n">norm_universe</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">ignh</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">_top</span><span class="o">.</span><span class="n">true_select_atoms</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="n">ignh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
    <span class="n">res_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">resids</span><span class="p">)</span>
    <span class="n">res_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">resids</span><span class="p">)</span>

    <span class="c1"># calculate nat. contacts for ref structure</span>
    <span class="n">NC</span><span class="p">,</span> <span class="n">NC_details</span> <span class="o">=</span> <span class="n">get_Native_Contacts</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d_cutoff</span><span class="o">=</span><span class="n">d_cutoff</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>

    <span class="c1"># PLOT</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># conditions for markersize</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">res_max</span> <span class="o">-</span> <span class="n">res_min</span> <span class="o">&gt;=</span> <span class="mi">70</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">res_max</span> <span class="o">-</span> <span class="n">res_min</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="k">for</span> <span class="n">ndx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">NC</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="o">*</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>

    <span class="c1"># find matching contacts ij</span>
    <span class="k">if</span> <span class="n">DCA_fin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">DCA</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">read_DCA_file</span><span class="p">(</span><span class="n">DCA_fin</span><span class="p">,</span> <span class="n">n_DCA</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">DCA_cols</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">DCA_skiprows</span><span class="p">,</span> <span class="n">filter_DCA</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">filter_DCA</span><span class="p">,</span> <span class="n">RES_range</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">RES_range</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">DCA</span><span class="p">:</span>     <span class="c1"># if item is in both lists plot it green otherwise red</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">NC</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.6</span><span class="o">*</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.6</span><span class="o">*</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>

    <span class="c1"># plt.legend(loc=&quot;upper left&quot;, numpoints=1)</span>
    <span class="k">if</span> <span class="n">res_max</span> <span class="o">-</span> <span class="n">res_min</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_down</span><span class="p">(</span><span class="n">res_min</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_up</span><span class="p">(</span><span class="n">res_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_down</span><span class="p">(</span><span class="n">res_min</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_up</span><span class="p">(</span><span class="n">res_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># this locator puts ticks at regular intervals</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_down</span><span class="p">(</span><span class="n">res_min</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_up</span><span class="p">(</span><span class="n">res_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_down</span><span class="p">(</span><span class="n">res_min</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_up</span><span class="p">(</span><span class="n">res_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Residue i&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Residue j&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contact Map of </span><span class="si">{</span><span class="n">pdbid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">save_plot</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pdbid</span><span class="si">}</span><span class="s2">_Fig_Contact_Map.png&quot;</span><span class="p">,</span> <span class="n">filedir</span><span class="o">=</span><span class="s2">&quot;./plots&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_Contact_Map_Distances"><a class="viewcode-back" href="../../../pyrexMD.analysis.html#pyrexMD.analysis.contacts.plot_Contact_Map_Distances">[docs]</a><span class="k">def</span> <span class="nf">plot_Contact_Map_Distances</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">NC</span><span class="p">,</span> <span class="n">NC_dist</span><span class="p">,</span> <span class="n">pdbid</span><span class="o">=</span><span class="s2">&quot;pdbid&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create contact map with color-coded distances for selected contact pairs.</span>
<span class="sd">    Distances larger than the highest value of the colorbar will be displayed in grey.</span>

<span class="sd">    .. Warning :: vmin and vmax do only modify the limits of the color bar. They</span>
<span class="sd">        do not affect the color mapping of the contacts, which is defined in cmap.</span>

<span class="sd">    Args:</span>
<span class="sd">        ref (universe, str): reference universe or pdb. Used to detect if target</span>
<span class="sd">          is protein or nucleic to select pre-defined color map.</span>
<span class="sd">        NC (list): output of get_NC_distances()</span>
<span class="sd">        NC_dist (list): output of get_NC_distances()</span>
<span class="sd">        pdbid (str): pdbid which is used for plot title</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        cmap (None, dict):</span>
<span class="sd">          | dictionary with &quot;color&quot;:&quot;threshold&quot; pairs, e.g. &quot;red&quot;:12.0</span>
<span class="sd">          | None: use pre-defined cmaps for Protein and RNA targets</span>
<span class="sd">        vmin (None, float)</span>
<span class="sd">        vmax (None, float)</span>
<span class="sd">        ms (None, int): marker size (should be divisible by 2)</span>
<span class="sd">        title (None, str): None, &quot;default&quot; or any title string</span>
<span class="sd">        save_plot (bool)</span>

<span class="sd">    .. hint:: Args and Keyword Args of misc.figure() and misc.add_cbar() are also valid.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig (class)</span>
<span class="sd">            matplotlib.figure.Figure</span>
<span class="sd">        ax (class, list)</span>
<span class="sd">            ax or list of axes ~ matplotlib.axes._subplots.Axes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__HELP__cmap2seq</span><span class="p">(</span><span class="n">cmap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        converts cmaps with &quot;color&quot;:&quot;threshold&quot; items to cmap sequence as</span>
<span class="sd">        required by misc.create_cmap()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="o">/</span><span class="n">vmax</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">seq</span>
    <span class="c1">############################################################################</span>
    <span class="n">cmap_Protein</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="s2">&quot;lightgreen&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                    <span class="s2">&quot;yellow&quot;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
                    <span class="s2">&quot;orange&quot;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span>
                    <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="mf">6.0</span><span class="p">}</span>
    <span class="n">cmap_RNA</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
                <span class="s2">&quot;lightgreen&quot;</span><span class="p">:</span> <span class="mf">6.0</span><span class="p">,</span>
                <span class="s2">&quot;yellow&quot;</span><span class="p">:</span> <span class="mf">8.0</span><span class="p">,</span>
                <span class="s2">&quot;orange&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
                <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="mf">12.0</span><span class="p">}</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
               <span class="s2">&quot;vmin&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
               <span class="s2">&quot;vmax&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
               <span class="s2">&quot;cbar_label&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;Residue Pair Distance ($\AA$)&quot;</span><span class="p">,</span>
               <span class="s2">&quot;cbar_fontweight&quot;</span><span class="p">:</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span>
               <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
               <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">}</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="s2">&quot;nucleic&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap_Protein</span>
    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="s2">&quot;nucleic&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap_RNA</span>
    <span class="c1"># init values</span>
    <span class="k">if</span> <span class="s2">&quot;figsize&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="c1">############################################################################</span>
    <span class="c1"># PLOT</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">_CMAP</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">create_cmap</span><span class="p">(</span><span class="n">__HELP__cmap2seq</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">cmap</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">_CFG</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">deepcopy_without</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">add_cbar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">_CMAP</span><span class="p">,</span> <span class="o">**</span><span class="n">_CFG</span><span class="p">)</span>

    <span class="c1"># conditions for markersize</span>
    <span class="n">I</span><span class="p">,</span> <span class="n">J</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">unzip</span><span class="p">(</span><span class="n">NC</span><span class="p">)</span>
    <span class="n">res_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">I</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
    <span class="n">res_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">I</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">res_max</span> <span class="o">-</span> <span class="n">res_min</span> <span class="o">&gt;=</span> <span class="mi">70</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">res_max</span> <span class="o">-</span> <span class="n">res_min</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="c1">#PLOT color-coded native contacts</span>
    <span class="k">for</span> <span class="n">ndx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">NC</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">NC_dist</span><span class="p">[</span><span class="n">ndx</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.6</span><span class="o">*</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="c1"># if NC distance is outside of cmap: color silver</span>
        <span class="k">if</span> <span class="n">NC_dist</span><span class="p">[</span><span class="n">ndx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.6</span><span class="o">*</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>

    <span class="c1"># plt.legend(loc=&quot;upper left&quot;, numpoints=1)</span>
    <span class="k">if</span> <span class="n">res_max</span> <span class="o">-</span> <span class="n">res_min</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_down</span><span class="p">(</span><span class="n">res_min</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_up</span><span class="p">(</span><span class="n">res_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_down</span><span class="p">(</span><span class="n">res_min</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_up</span><span class="p">(</span><span class="n">res_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># this locator puts ticks at regular intervals</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_down</span><span class="p">(</span><span class="n">res_min</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_up</span><span class="p">(</span><span class="n">res_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_down</span><span class="p">(</span><span class="n">res_min</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_up</span><span class="p">(</span><span class="n">res_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Residue i&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Residue j&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contact Map of </span><span class="si">{</span><span class="n">pdbid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">save_plot</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pdbid</span><span class="si">}</span><span class="s2">_Fig_Contact_Map.png&quot;</span><span class="p">,</span> <span class="n">filedir</span><span class="o">=</span><span class="s2">&quot;./plots&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_DCA_TPR"><a class="viewcode-back" href="../../../pyrexMD.analysis.html#pyrexMD.analysis.contacts.plot_DCA_TPR">[docs]</a><span class="k">def</span> <span class="nf">plot_DCA_TPR</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">DCA_fin</span><span class="p">,</span> <span class="n">n_DCA</span><span class="p">,</span> <span class="n">d_cutoff</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="s1">&#39;protein&#39;</span><span class="p">,</span> <span class="n">pdbid</span><span class="o">=</span><span class="s1">&#39;pdbid&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots true positive rate (TPR) for number of used DCA contacts.</span>

<span class="sd">    - calculates shortest RES distance of the selection (only heavy atoms if ignh is True)</span>
<span class="sd">    - if distance is below threshold: DCA contact is True</span>

<span class="sd">    .. Note:: figure shows</span>

<span class="sd">        - blue line: TPR</span>
<span class="sd">        - red line: 75% cutoff threshold (TPR of used number of contacts should be above 75% for contact-guided REX, see https://doi.org/10.1371/journal.pone.0242072)</span>
<span class="sd">        - orange lines: suggested/guessed optimum number of contacts and the corresponding TPR</span>
<span class="sd">        - orange region: region of interest between L/2 and L contacts</span>


<span class="sd">    Args:</span>
<span class="sd">        ref (str): reference path</span>
<span class="sd">        ref (universe, atomgrp): reference structure</span>
<span class="sd">        DCA_fin (str): DCA input file (path)</span>
<span class="sd">        n_DCA (int): number of used DCA contacts</span>
<span class="sd">        d_cutoff (float): cutoff distance for native contacts</span>
<span class="sd">        sel (str): selection string</span>
<span class="sd">        pdbid (str): pdbid; used for plot title and figure name</span>
<span class="sd">        verbose (bool): prints the total residue length of reference</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        DCA_cols (tuple, list): columns containing the RES pairs in DCA_fin</span>
<span class="sd">        DCA_skiprows (int):</span>
<span class="sd">          | skip header rows of DCA_fin</span>
<span class="sd">          | -1 or &quot;auto&quot;: auto detect</span>
<span class="sd">        filter_DCA (bool):</span>
<span class="sd">          | True: ignore DCA pairs with abs(i-j) &lt; 4</span>
<span class="sd">          | False: use all DCA pairs w/o applying filter</span>
<span class="sd">        RES_range (None):</span>
<span class="sd">          | [RES_min, RES_max] range. Ignore invalid RES ids</span>
<span class="sd">          | None: do not narrow down RES range</span>
<span class="sd">        ignh (bool): ignore hydrogen (mass &lt; 1.2)</span>
<span class="sd">        norm (bool): apply topology.norm_universe()</span>
<span class="sd">        TPR_layer (str):</span>
<span class="sd">          | plot TPR curve in foreground or background layer</span>
<span class="sd">          | &quot;fg&quot;, &quot;foreground&quot;, &quot;bg&quot;, &quot;background&quot;</span>
<span class="sd">        color (str)</span>
<span class="sd">        shade_area (bool): shade area between L/2 and L ranked contacts</span>
<span class="sd">        shade_color (str)</span>
<span class="sd">        shade_alpha (float)</span>
<span class="sd">        hline_color (None, str): color of 75p threshold (horizontal line)</span>
<span class="sd">        hline_ls (str): linestyle of hline (default: &quot;-&quot;)</span>
<span class="sd">        nDCA_opt_color (None, str):</span>
<span class="sd">          | color of optimal/recommended nDCA threshold</span>
<span class="sd">          | nDCA_opt = misc.round_up(3/4*len(ref.residues), base=5))</span>
<span class="sd">          | (vertical line ~ nDCA_opt)</span>
<span class="sd">          | (horizontal line ~ TPR(nDCA_opt))</span>
<span class="sd">        nDCA_opt_ls (str): linestyle of nDCA_opt (default: &quot;--&quot;)</span>
<span class="sd">        save_plot (bool)</span>
<span class="sd">        save_log (bool)</span>
<span class="sd">        figsize (tuple)</span>
<span class="sd">        marker (None, str): marker</span>
<span class="sd">        ms (int): markersize</span>
<span class="sd">        ls (str): linestyle</span>
<span class="sd">        alpha (float): alpha value</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig (class)</span>
<span class="sd">            matplotlib.figure.Figure</span>
<span class="sd">        ax (class, list)</span>
<span class="sd">            ax or list of axes ~ matplotlib.axes._subplots.Axes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;DCA_cols&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
               <span class="s2">&quot;DCA_skiprows&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
               <span class="s2">&quot;filter_DCA&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;RES_range&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
               <span class="s2">&quot;ignh&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;norm&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;TPR_layer&quot;</span><span class="p">:</span> <span class="s2">&quot;fg&quot;</span><span class="p">,</span>
               <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
               <span class="s2">&quot;shade_area&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;shade_color&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
               <span class="s2">&quot;shade_alpha&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
               <span class="s2">&quot;hline_color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
               <span class="s2">&quot;hline_ls&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
               <span class="s2">&quot;nDCA_opt_color&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
               <span class="s2">&quot;nDCA_opt_ls&quot;</span><span class="p">:</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span>
               <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s2">&quot;save_log&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span>
               <span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
               <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="s2">&quot;ls&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
               <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># load universe</span>
    <span class="k">if</span> <span class="n">pdbid</span> <span class="o">==</span> <span class="s1">&#39;pdbid&#39;</span><span class="p">:</span>
        <span class="n">pdbid</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">get_PDBid</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">ref</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">:</span>
        <span class="n">_top</span><span class="o">.</span><span class="n">norm_universe</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">ignh</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">_top</span><span class="o">.</span><span class="n">true_select_atoms</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="n">ignh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">norm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
    <span class="c1"># read DCA and calculate TPR</span>
    <span class="n">DCA</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">read_DCA_file</span><span class="p">(</span><span class="n">DCA_fin</span><span class="p">,</span> <span class="n">n_DCA</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">DCA_cols</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">DCA_skiprows</span><span class="p">,</span> <span class="n">filter_DCA</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">filter_DCA</span><span class="p">,</span> <span class="n">RES_range</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">RES_range</span><span class="p">)</span>
    <span class="n">DCA_TPR</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List with TPR of DCA contacts with d &lt; d_cutoff</span>
    <span class="n">SD</span> <span class="o">=</span> <span class="n">_ana</span><span class="o">.</span><span class="n">get_shortest_RES_distances</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">sel</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">RES_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">resids</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DCA</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">SD</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">RES_min</span><span class="p">][</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">RES_min</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">d_cutoff</span><span class="p">:</span>  <span class="c1"># shift RES ids to match matrix indices</span>
            <span class="n">z</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">percent_value</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">percent</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">DCA_TPR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">percent_value</span><span class="p">)</span>

    <span class="c1"># LOG FILE</span>
    <span class="c1"># List with number of DCA contacts and TPR values</span>
    <span class="n">DCA_TPR_sorted</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DCA_TPR</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DCA_TPR</span><span class="p">))]</span>
    <span class="n">DCA_TPR_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">DCA_TPR_sorted</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># sort by TPR value</span>

    <span class="c1"># PLOT: find optimum for number of DCA contacts</span>
    <span class="c1"># x-axis: number of DCA contacts</span>
    <span class="c1"># y-axis: % of DCA contacts with d &lt;= d_cuttoff</span>
    <span class="k">with</span> <span class="n">sns</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s1">&#39;darkgrid&#39;</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TPR_layer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;bg&quot;</span> <span class="ow">or</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TPR_layer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;background&quot;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_DCA</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">DCA_TPR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ls</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_DCA</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">DCA_TPR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># plt.legend(loc=&quot;upper right&quot;, numpoints=1)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_DCA</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">105</span><span class="p">)</span>
        <span class="c1"># if min(DCA_TPR) &lt; 50:</span>
        <span class="c1">#     plt.ylim(0, 105)  # full range for TPR</span>
        <span class="c1"># else:</span>
        <span class="c1">#     plt.ylim(50, 105) # smaller range for very good TPR</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">shade_area</span><span class="p">:</span>
            <span class="n">L1</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">round_down</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">n_residues</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">L2</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">n_residues</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">shade_alpha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">shade_color</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L1</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;L/2&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">shade_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">L2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">shade_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">hline_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">hline_color</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">hline_ls</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="s2">&quot;75&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">hline_color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
            <span class="c1">#_misc.set_pad(ax, xpad=None, ypad=10) # set padding after tight_layout()</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">nDCA_opt_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nDCA_opt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_misc</span><span class="o">.</span><span class="n">round_to_base</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">residues</span><span class="p">),</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">nDCA_opt_TPR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">DCA_TPR</span><span class="p">[</span><span class="n">nDCA_opt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># requires index shift by 1 to get correct value</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">nDCA_opt_TPR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">nDCA_opt_color</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">nDCA_opt_ls</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">nDCA_opt_TPR</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">nDCA_opt_TPR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">nDCA_opt_color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">nDCA_opt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">nDCA_opt_color</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">nDCA_opt_ls</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">nDCA_opt</span><span class="o">-</span><span class="mf">1.3</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">nDCA_opt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">nDCA_opt_color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
            <span class="c1">#_misc.set_pad(ax, xpad=10, ypad=10)  # set padding after tight_layout()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of ranked contacts&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;True Positive Rate (%)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TPR of </span><span class="si">{</span><span class="n">pdbid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TPR_layer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;fg&quot;</span> <span class="ow">or</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TPR_layer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;foreground&quot;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_DCA</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">DCA_TPR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ls</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_DCA</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">DCA_TPR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">hline_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_misc</span><span class="o">.</span><span class="n">set_pad</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xpad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ypad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># set padding after tight_layout()</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">nDCA_opt_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_misc</span><span class="o">.</span><span class="n">set_pad</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xpad</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ypad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>    <span class="c1"># set padding after tight_layout()</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">residues</span><span class="p">)</span><span class="si">}</span><span class="s2"> residues&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">save_plot</span><span class="p">:</span>
            <span class="n">_misc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pdbid</span><span class="si">}</span><span class="s2">_Fig_DCA_TPR.png&quot;</span><span class="p">,</span> <span class="n">filedir</span><span class="o">=</span><span class="s2">&quot;./plots&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">save_log</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;./logs&quot;</span><span class="p">)</span>
            <span class="n">file_dir</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">pdbid</span><span class="si">}</span><span class="s2">_DCA_TPR.log&quot;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Format:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Number of DCA Contacts </span><span class="se">\t</span><span class="s2"> True Positive Rate (%)</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;10 Best values (100</span><span class="si">% e</span><span class="s2">xcluded):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DCA_TPR_sorted</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">DCA_TPR_sorted</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">100.0</span><span class="p">:</span>
                        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DCA_TPR_sorted</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">DCA_TPR_sorted</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Full list:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="mf">0.0</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DCA_TPR</span><span class="p">)):</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">DCA_TPR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved log as: </span><span class="si">{</span><span class="n">file_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="get_QNative"><a class="viewcode-back" href="../../../pyrexMD.analysis.html#pyrexMD.analysis.contacts.get_QNative">[docs]</a><span class="k">def</span> <span class="nf">get_QNative</span><span class="p">(</span><span class="n">mobile</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="s2">&quot;protein and name CA&quot;</span><span class="p">,</span> <span class="n">sss</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                <span class="n">d_cutoff</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get QValue for native contacts.</span>

<span class="sd">    - norms and aligns mobile to ref so that atomgroups have same resids</span>
<span class="sd">    - performs native contact analysis</span>

<span class="sd">    Args:</span>
<span class="sd">        mobile (universe): mobile structure with trajectory</span>
<span class="sd">        ref (universe): reference structure</span>
<span class="sd">        sel (str): selection string</span>
<span class="sd">        sss (list):</span>
<span class="sd">          | [start, stop, step]</span>
<span class="sd">          | start (None, int): start frame</span>
<span class="sd">          | stop (None, int): stop frame</span>
<span class="sd">          | step (None, int): step size</span>
<span class="sd">        d_cutoff (float): cutoff distance for native contacts</span>
<span class="sd">        plot (bool)</span>
<span class="sd">        verbose (bool)</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        sel1 (str): selection string for contacting group (1 to 1 mapping)</span>
<span class="sd">        sel2 (str): selection string for contacting group (1 to 1 mapping)</span>
<span class="sd">        method (str):</span>
<span class="sd">          | method for QValues calculation</span>
<span class="sd">          | &#39;radius_cut&#39;: native if d &lt; d_cutoff</span>
<span class="sd">          | &#39;soft_cut&#39;: see help(MDAnalysis.analysis.contacts.soft_cut_q)</span>
<span class="sd">          | &#39;hardcut&#39;: native if d &lt; d_ref</span>
<span class="sd">        start (None, int): start frame</span>
<span class="sd">        stop (None, int): stop frame</span>
<span class="sd">        step (None, int): step size</span>
<span class="sd">        color (str): &quot;r&quot;</span>
<span class="sd">        alpha (float): 1</span>
<span class="sd">        marker (str): &quot;.&quot;</span>
<span class="sd">        ms (int): 4</span>
<span class="sd">        lw (int): 0</span>
<span class="sd">        save_plot (bool)</span>
<span class="sd">        save_as (str): &quot;QNative.png&quot;</span>

<span class="sd">    .. Note :: sel (arg) is ignored if sel1 or sel2 (kwargs) are passed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FRAMES (list)</span>
<span class="sd">            list with frames</span>
<span class="sd">        QNATIVE (list)</span>
<span class="sd">            list with fraction of native contacts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sel1&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
               <span class="s2">&quot;sel2&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
               <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;radius_cut&quot;</span><span class="p">,</span>
               <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
               <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
               <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
               <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
               <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
               <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
               <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
               <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s2">&quot;save_as&quot;</span><span class="p">:</span> <span class="s2">&quot;QNative.png&quot;</span><span class="p">}</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">sel1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cfg</span><span class="o">.</span><span class="n">sel2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">sel1</span> <span class="o">=</span> <span class="n">sel</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">sel2</span> <span class="o">=</span> <span class="n">sel</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">sel1</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cfg</span><span class="o">.</span><span class="n">sel2</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">_misc</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Set either sel (arg) or both sel1 and sel2 (kwargs).&quot;</span><span class="p">)</span>
    <span class="c1">#####################################################################</span>
    <span class="n">_top</span><span class="o">.</span><span class="n">norm_and_align_universe</span><span class="p">(</span><span class="n">mobile</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

    <span class="n">ref1</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">sel1</span><span class="p">)</span>  <span class="c1"># reference group 1 in reference conformation</span>
    <span class="n">ref2</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">sel2</span><span class="p">)</span>  <span class="c1"># reference group 2 in reference conformation</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">_contacts</span><span class="o">.</span><span class="n">Contacts</span><span class="p">(</span><span class="n">mobile</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">sel1</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">sel2</span><span class="p">),</span> <span class="n">refgroup</span><span class="o">=</span><span class="p">(</span><span class="n">ref1</span><span class="p">,</span> <span class="n">ref2</span><span class="p">),</span>
                                 <span class="n">radius</span><span class="o">=</span><span class="n">d_cutoff</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">FRAMES</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">timeseries</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">QNATIVE</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">timeseries</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;average QNative value: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">QNATIVE</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FRAMES</span><span class="p">,</span> <span class="n">QNATIVE</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FRAMES</span><span class="p">,</span> <span class="n">QNATIVE</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frame&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;QNative&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">save_plot</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">save_as</span><span class="p">,</span> <span class="n">create_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">FRAMES</span><span class="p">,</span> <span class="n">QNATIVE</span></div>


<div class="viewcode-block" id="get_QBias"><a class="viewcode-back" href="../../../pyrexMD.analysis.html#pyrexMD.analysis.contacts.get_QBias">[docs]</a><span class="k">def</span> <span class="nf">get_QBias</span><span class="p">(</span><span class="n">mobile</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">sss</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">d_cutoff</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
              <span class="n">prec</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get QValue for formed bias contacts.</span>

<span class="sd">    .. Note :: selection of get_QBias() is hardcoded to sel=&#39;protein and name CA&#39;.</span>

<span class="sd">      Reason: bias contacts are unique RES PAIRS and grow &#39;slowly&#39;, but going from</span>
<span class="sd">      sel=&#39;protein and name CA&#39; to sel=&#39;protein&#39; increases the atom count</span>
<span class="sd">      significantly. Most of them will count as non-native and thus make</span>
<span class="sd">      the QBias value very low.</span>

<span class="sd">    .. Note :: MDAnalysis&#39; qvalue algorithm includes selfcontacts. Comparison of</span>
<span class="sd">      both methods yields better results when the kwarg include_selfcontacts</span>
<span class="sd">      (bool) is set to True. However this improves the calculated QBias value</span>
<span class="sd">      artificially (e.g. even when all used bias contacts are never formed,</span>
<span class="sd">      QBias will not be zero due to the selfcontact counts)</span>

<span class="sd">    Args:</span>
<span class="sd">        mobile (universe): mobile structure with trajectory</span>
<span class="sd">        bc (list): list with bias contacts to analyze</span>
<span class="sd">        sss (list):</span>
<span class="sd">          | [start, stop, step]</span>
<span class="sd">          | start (None, int): start frame</span>
<span class="sd">          | stop (None, int): stop frame</span>
<span class="sd">          | step (None, int): step size</span>
<span class="sd">        d_cutoff (float): cutoff distance for native contacts</span>
<span class="sd">        prec (None, int): rounding precision</span>
<span class="sd">        norm (bool): norm universe before calculation.</span>
<span class="sd">        plot (bool)</span>
<span class="sd">        warn (bool): print important warnings about usage of this function.</span>
<span class="sd">        verbose (bool)</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        dtype (dtype): data type of returned contact matrix CM</span>
<span class="sd">        include_selfcontacts (bool):</span>
<span class="sd">          | sets norm of QBIAS. Default is False.</span>
<span class="sd">          | True: includes selfcontacts on main diagonal of CM (max count &gt; len(bc))</span>
<span class="sd">          | False: ignores selfcontacts on main diagonal of CM (max count == len(bc))</span>
<span class="sd">        softcut (bool): Increase QBias if np.isclose(d, d_cutoff, atol=softcut_tol) is True. Defaults to True.</span>
<span class="sd">        softcut_tol (float): Softcut tolerance. Defatuls to 0.2 (Angstrom).</span>
<span class="sd">        softcut_inc: Increase QBias by this value if softcut applies. Defaults to 0.25.</span>
<span class="sd">        start (None, int): start frame</span>
<span class="sd">        stop (None, int): stop frame</span>
<span class="sd">        step (None, int): step size</span>
<span class="sd">        figsize (tuple)</span>
<span class="sd">        color (str): &quot;r&quot;</span>
<span class="sd">        alpha (float): 1</span>
<span class="sd">        marker (str): &quot;.&quot;</span>
<span class="sd">        ms (int): 4</span>
<span class="sd">        lw (int): 0</span>
<span class="sd">        save_plot (bool)</span>
<span class="sd">        save_as (str): &quot;QBias.png&quot;</span>
<span class="sd">        disable (bool): hide/show progress bar</span>

<span class="sd">    Returns:</span>
<span class="sd">        FRAMES (array)</span>
<span class="sd">            array with frame numbers</span>
<span class="sd">        QBIAS (array)</span>
<span class="sd">            array with fraction of formed bias contacts</span>
<span class="sd">        CM (array)</span>
<span class="sd">            array with contact matrices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__HELP_softcut</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">d0</span><span class="p">,</span> <span class="n">tol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns value between 0 and 1, based on difference between d-d0 and d0+tol</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">d0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">tol</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">d0</span><span class="p">)</span><span class="o">/</span><span class="n">tol</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
               <span class="s2">&quot;include_selfcontacts&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s2">&quot;softcut&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s2">&quot;softcut_tol&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
               <span class="s2">&quot;softcut_inc&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
               <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
               <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
               <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
               <span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
               <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
               <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
               <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
               <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
               <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s2">&quot;save_as&quot;</span><span class="p">:</span> <span class="s2">&quot;QBias.png&quot;</span><span class="p">,</span>
               <span class="s2">&quot;disable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">sel</span> <span class="o">=</span> <span class="s2">&quot;protein and name CA&quot;</span>
    <span class="c1">################################################################################</span>
    <span class="k">if</span> <span class="n">warn</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Note 1: selection of get_QBias() is hardcoded to sel=&#39;protein and name CA&#39;.&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Reason: bias contacts are unique RES PAIRS and grow &#39;slowly&#39;, but going from sel=&#39;protein and name CA&#39; to sel=&#39;protein&#39; increases the atom count significantly. Most of them will count as non-native and thus make the QBias value very low.&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Note 2: MDAnalysis&#39; qvalue algorithm includes selfcontacts. Comparison of both methods yields better results when include_selfcontacts (bool, see kwargs) is set to True. However this improves the calculated QBias value artificially (e.g. even when all used bias contacts are never formed, QBias will not be zero due to the selfcontact counts)&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
        <span class="n">_top</span><span class="o">.</span><span class="n">norm_universe</span><span class="p">(</span><span class="n">mobile</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">mobile</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>

    <span class="n">QBIAS</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># QBias value (fraction of formed bias contacts)</span>
    <span class="c1">#CM = []     # Contact Matrices</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;calculating distance matrices...&quot;</span><span class="p">)</span>
    <span class="n">DM</span> <span class="o">=</span> <span class="n">_ana</span><span class="o">.</span><span class="n">get_Distance_Matrices</span><span class="p">(</span><span class="n">mobile</span><span class="o">=</span><span class="n">mobile</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">sss</span><span class="o">=</span><span class="p">[</span><span class="n">cfg</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">step</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">disable</span><span class="p">)</span>
    <span class="n">CM</span> <span class="o">=</span> <span class="p">[(</span><span class="n">dm</span> <span class="o">&lt;=</span> <span class="n">d_cutoff</span><span class="p">)</span> <span class="k">for</span> <span class="n">dm</span> <span class="ow">in</span> <span class="n">DM</span><span class="p">]</span>  <span class="c1"># converts distance matrix to bool matrix -&gt; use as contact matrix</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;calculating QBias...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">CM</span><span class="p">)),</span> <span class="n">disable</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">disable</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">CM</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">softcut</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">DM</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">d_cutoff</span> <span class="o">&lt;=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">softcut_tol</span><span class="p">):</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="n">__HELP_softcut</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">d_cutoff</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">softcut_tol</span><span class="p">)</span>
                    <span class="n">CM</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">include_selfcontacts</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># norm based on used bias contacts</span>
            <span class="n">QBIAS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bc</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># norm based on used bias contacts and selfcontacts</span>
            <span class="n">QBIAS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">count</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bc</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">prec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">QBIAS</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">QBIAS</span><span class="p">]</span>
    <span class="n">FRAMES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">QBIAS</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;average QBias value: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">QBIAS</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FRAMES</span><span class="p">,</span> <span class="n">QBIAS</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FRAMES</span><span class="p">,</span> <span class="n">QBIAS</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frame&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;QBias&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">save_plot</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">save_as</span><span class="p">,</span> <span class="n">create_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">FRAMES</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">QBIAS</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">CM</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_QBias_TPFP"><a class="viewcode-back" href="../../../pyrexMD.analysis.html#pyrexMD.analysis.contacts.get_QBias_TPFP">[docs]</a><span class="k">def</span> <span class="nf">get_QBias_TPFP</span><span class="p">(</span><span class="n">mobile</span><span class="p">,</span> <span class="n">BC</span><span class="p">,</span> <span class="n">NC</span><span class="p">,</span> <span class="n">sss</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">d_cutoff</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                   <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get QValue of true positive (TP) and false positive (FP) bias contacts.</span>

<span class="sd">    .. Note :: selection of this function is hardcoded to sel=&#39;protein and name CA&#39;.</span>

<span class="sd">      Reason: bias contacts are unique RES PAIRS and grow &#39;slowly&#39;, but going from</span>
<span class="sd">      sel=&#39;protein and name CA&#39; to sel=&#39;protein&#39; increases the atom count</span>
<span class="sd">      significantly. Most of them will count as non-native and thus make</span>
<span class="sd">      the QBias value very low.</span>

<span class="sd">    .. Note :: MDAnalysis&#39; qvalue algorithm includes selfcontacts. Comparison of</span>
<span class="sd">      both methods yields better results when the kwarg include_selfcontacts</span>
<span class="sd">      (bool) is set to True. However this improves the calculated QBias value</span>
<span class="sd">      artificially (e.g. even when all used bias contacts are never formed,</span>
<span class="sd">      QBias will not be zero due to the selfcontact counts)</span>

<span class="sd">    Args:</span>
<span class="sd">        mobile (universe): mobile structure with trajectory</span>
<span class="sd">        BC (list): list with bias contacts (saved as tuples (RESi, RESj))</span>
<span class="sd">        NC (list): list with native contacts (saved as tuples (RESi, RESj))</span>
<span class="sd">        sss (list):</span>
<span class="sd">          | [start, stop, step]</span>
<span class="sd">          | start (None, int): start frame</span>
<span class="sd">          | stop (None, int): stop frame</span>
<span class="sd">          | step (None, int): step size</span>
<span class="sd">        d_cutoff (float): cutoff distance for native contacts</span>
<span class="sd">        prec (None, int): rounding precision</span>
<span class="sd">        norm (bool): norm universe before calculation.</span>
<span class="sd">        plot (bool)</span>
<span class="sd">        verbose (bool)</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        dtype (dtype): data type of returned contact matrix CM</span>
<span class="sd">        include_selfcontacts (bool):</span>
<span class="sd">          | sets norm of QBIAS. Default is False.</span>
<span class="sd">          | True: includes selfcontacts on main diagonal of CM (max count &gt; len(bc))</span>
<span class="sd">          | False: ignores selfcontacts on main diagonal of CM (max count == len(bc))</span>
<span class="sd">        start (None, int): start frame</span>
<span class="sd">        stop (None, int): stop frame</span>
<span class="sd">        step (None, int): step size</span>
<span class="sd">        color_TP (str): color of true positive QBias. Defaults to &quot;g&quot;.</span>
<span class="sd">        color_FP (str): color of false positive QBias. Defaults to &quot;r&quot;.</span>
<span class="sd">        alpha (float): 0.3</span>
<span class="sd">        marker (str): &quot;.&quot;</span>
<span class="sd">        disable (bool): hide/show progress bar</span>

<span class="sd">    Returns:</span>
<span class="sd">        FRAMES (array)</span>
<span class="sd">            array with frame numbers</span>
<span class="sd">        TP (array)</span>
<span class="sd">            array with Qvalue of true positive bias contacts</span>
<span class="sd">        FP (array)</span>
<span class="sd">            array with Qvalue of false positive bias contacts</span>
<span class="sd">        CM (array)</span>
<span class="sd">            array with distance matrices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
               <span class="s2">&quot;include_selfcontacts&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
               <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
               <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
               <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">sss</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
               <span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
               <span class="s2">&quot;color_TP&quot;</span><span class="p">:</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span>
               <span class="s2">&quot;color_FP&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
               <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
               <span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
               <span class="s2">&quot;disable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">sel</span> <span class="o">=</span> <span class="s2">&quot;protein and name CA&quot;</span>  <span class="c1"># selection must be hardcoded (see print msg below)</span>
    <span class="c1">################################################################################</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">BC</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">_misc</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;BC and NC must be list of tuples (RESi, RESj)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NC</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">_misc</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;BC and NC must be list of tuples (RESi, RESj)&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">BC</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">_misc</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;BC must be list of tuples (RESi, RESj)&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">NC</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">_misc</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;NC must be list of tuples (RESi, RESj)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
        <span class="n">_top</span><span class="o">.</span><span class="n">norm_universe</span><span class="p">(</span><span class="n">mobile</span><span class="p">)</span>

    <span class="n">CM</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Contact Matrices</span>
    <span class="n">TP</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Qvalue of true positive bias contacts (fraction of formed contacts)</span>
    <span class="n">FP</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Qvalue of false positive bias contacts (fraction of formed contacts)</span>
    <span class="n">len_BC_TP</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="kc">True</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">BC</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">NC</span><span class="p">])</span>
    <span class="n">len_BC_FP</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="kc">True</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">BC</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NC</span><span class="p">])</span>
    <span class="n">TPR</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">len_BC_FP</span><span class="o">/</span><span class="n">len_BC_TP</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The used bias contacts have a TPR of </span><span class="si">{</span><span class="n">TPR</span><span class="si">}</span><span class="s2">% with </span><span class="si">{</span><span class="n">len_BC_TP</span><span class="si">}</span><span class="s2"> native contacts and </span><span class="si">{</span><span class="n">len_BC_FP</span><span class="si">}</span><span class="s2"> non-native contacts.&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>

    <span class="c1"># calculate distance matrices</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Calculating Distance Matrices...&quot;</span><span class="p">)</span>
    <span class="n">DM</span> <span class="o">=</span> <span class="n">_ana</span><span class="o">.</span><span class="n">get_Distance_Matrices</span><span class="p">(</span><span class="n">mobile</span><span class="o">=</span><span class="n">mobile</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="n">sel</span><span class="p">,</span> <span class="n">sss</span><span class="o">=</span><span class="p">[</span><span class="n">cfg</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">step</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dm</span> <span class="ow">in</span> <span class="n">DM</span><span class="p">:</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="p">(</span><span class="n">dm</span> <span class="o">&lt;=</span> <span class="n">d_cutoff</span><span class="p">)</span>   <span class="c1"># converts distance matrix to bool matrix -&gt; use as contact matrix</span>
        <span class="n">CM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>

    <span class="c1"># calculate TP and FP</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Calculating QValues...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cm</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">CM</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">disable</span><span class="p">):</span>
        <span class="n">count_TP</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count_FP</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">BC</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">NC</span> <span class="ow">and</span> <span class="n">cm</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">count_TP</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NC</span> <span class="ow">and</span> <span class="n">cm</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">count_FP</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">include_selfcontacts</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># norm based on used bias contacts</span>
            <span class="n">TP</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_TP</span><span class="o">/</span><span class="n">len_BC_TP</span><span class="p">)</span>
            <span class="n">FP</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_FP</span><span class="o">/</span><span class="n">len_BC_FP</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># norm based on used bias contacts and selfcontacts</span>
            <span class="n">TP</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">count_TP</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">len_BC_TP</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="p">)))</span>
            <span class="n">FP</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_FP</span><span class="o">/</span><span class="n">len_BC_FP</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">prec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">TP</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TP</span><span class="p">]</span>
        <span class="n">FP</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">FP</span><span class="p">]</span>
    <span class="n">FRAMES</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TP</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;average true positive QBias value: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">TP</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="n">_misc</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;average false positive QBias value: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">FP</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="n">_cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">deepcopy_without</span><span class="p">([</span><span class="s2">&quot;color_TP&quot;</span><span class="p">,</span> <span class="s2">&quot;color_FP&quot;</span><span class="p">])</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_ana</span><span class="o">.</span><span class="n">PLOT</span><span class="p">(</span><span class="n">xdata</span><span class="o">=</span><span class="n">FRAMES</span><span class="p">,</span> <span class="n">ydata</span><span class="o">=</span><span class="n">TP</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">color_TP</span><span class="p">,</span> <span class="o">**</span><span class="n">_cfg</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frame&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;True Positive QBias&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_ana</span><span class="o">.</span><span class="n">PLOT</span><span class="p">(</span><span class="n">xdata</span><span class="o">=</span><span class="n">FRAMES</span><span class="p">,</span> <span class="n">ydata</span><span class="o">=</span><span class="n">FP</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">color_FP</span><span class="p">,</span> <span class="o">**</span><span class="n">_cfg</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frame&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;False Positive QBias&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">FRAMES</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">TP</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">FP</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">CM</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_formed_contactpairs"><a class="viewcode-back" href="../../../pyrexMD.analysis.html#pyrexMD.analysis.contacts.get_formed_contactpairs">[docs]</a><span class="k">def</span> <span class="nf">get_formed_contactpairs</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">sel</span><span class="o">=</span><span class="s2">&quot;protein and name CA&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get formed contact pairs by converting a contact matrix cm into a list with</span>
<span class="sd">    tuples (RESi,RESj).</span>

<span class="sd">    Args:</span>
<span class="sd">        u (universe): used to obtain topology information</span>
<span class="sd">        cm (array): single contact matrix of size (n_atoms, n_atoms)</span>
<span class="sd">        sel (str): selection string</span>
<span class="sd">        norm (bool): norm universe before obtaining topology information</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        include_selfcontacts (bool): include contacts on main diagonal of cm. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        CP (list)</span>
<span class="sd">            list with contact pairs (RESi,RESj)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;include_selfcontacts&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">_misc</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1">########################################################</span>
    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
        <span class="n">_top</span><span class="o">.</span><span class="n">norm_universe</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">RES</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span><span class="o">.</span><span class="n">resids</span>   <span class="c1"># get RESIDS information</span>
    <span class="n">CP</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list with contact pairs</span>

    <span class="c1">### test if input is single contact matrix</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cm</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">_misc</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;get_formed_contactpairs() expected contact map cm with size (n_atoms, n_atoms). You probably passed a contact map with size (n_frames, n_atoms, n_atoms)&quot;</span><span class="p">)</span>

    <span class="c1">### calculate contact pairs</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">include_selfcontacts</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="c1"># loop over upper triangle</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">CP</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">RES</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># loop over upper triangle including main diagonal</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cm</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">CP</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">RES</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">CP</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, KIT-MBS.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>